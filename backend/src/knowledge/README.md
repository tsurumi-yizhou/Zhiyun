# Knowledge 模块 (Knowledge & RAG)

`knowledge` 模块负责管理项目的非结构化与半结构化知识，通过 RAG (Retrieval-Augmented Generation) 增强 Agent 的决策能力。

## 核心功能

- **RAG 流程**: 结合向量数据库的语义搜索与知识图谱的逻辑搜索。
- **上下文压缩**: 自动识别并修剪与当前任务无关的冗余信息。
- **知识图谱**: 记录设计模式、业务逻辑关系和架构决策记录 (ADR)。

## 核心组件

- [store.rs](./store.rs): `VectorStore` 存储代码片段、文档和注释的嵌入向量。
- [graph.rs](./graph.rs): `KnowledgeGraph` 维护项目的高层架构关系。
- [retriever.rs](./retriever.rs): `Retriever` 执行多模态检索与重排 (Reranking)。

## 设计原则

- **事实优先**: 确保 Agent 检索到的信息是基于当前代码库的真实状态。
- **动态更新**: 随着代码的修改，索引和图谱应能实时或准实时更新。

## 架构设计细节

### 1. 混合检索策略 (Hybrid Retrieval)
- **多模态搜索**: 同时利用向量库进行模糊语义检索，利用知识图谱进行精确的逻辑依赖检索。
- **智能重排**: `Retriever` 对初步检索结果进行重排，确保最相关的代码上下文优先提供给 Agent。

### 2. 架构感知的知识图谱
- **关系建模**: 不仅记录符号定义，还记录架构决策 (ADR) 和复杂的业务逻辑链条。
- **影响分析**: 支持通过图查询评估代码变更对系统整体架构的影响。

### 3. 数据时效性
- **事实优先**: 所有检索结果都与当前活动 Thread 的代码状态保持强一致。
- **增量索引**: 采用流式处理技术，确保代码变更能即时反映在知识库中。